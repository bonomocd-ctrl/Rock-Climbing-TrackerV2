name: C++ doctest

on:
  push:
  pull_request:

jobs:
  test:
    runs-on: windows-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Set up Visual Studio (MSVC)
      uses: ilammy/msvc-dev-cmd@v1

    - name: Build tests
      shell: cmd
      run: |
        REM Create build directory if it doesn't exist
        if not exist "%GITHUB_WORKSPACE%\build" mkdir "%GITHUB_WORKSPACE%\build"

        REM Move into build directory
        pushd "%GITHUB_WORKSPACE%\build"

        REM Compile the project with doctest enabled
        cl /nologo /EHsc /std:c++17 /D RUN_TESTS ^
           "%GITHUB_WORKSPACE%\src\Rock-Climbing-TrackerV2.cpp" ^
           /Fe:Rock-Climbing-TrackerV2.exe

        REM Show build output for debugging
        dir

        REM Return to repo root
        popd


    - name: Run tests
      shell: cmd
      run: |
        call "%GITHUB_WORKSPACE%\build\Rock-Climbing-TrackerV2.exe"

